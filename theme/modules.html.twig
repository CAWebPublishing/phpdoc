{% extends "layout.html.twig" %}
{% import "macros.twig" as macros %}

{% set all_modules =  [] %}
{% set child_modules = [] %}
{% set fullwidth_only_modules = [] %}

{% for module in project.indexes.classes|filter(module => module.getName() starts with 'CAWeb_Module_' ) %}
    {% set data = [ module ] %}
    {# Child Modules, end with _Group, _Item, or _Slide #}
    {% if module.getName() matches '/_Group$|_Item$|_Slide$/' %}
        {% set child_modules = child_modules|merge(data) %}
    {% else %}
        {# Fullwidth Modules, start with Fullwidth_ #}
        {% if module.getName() matches '/^CAWeb_Module_Fullwidth_/' %}
            {% set fullwidth_only_modules = fullwidth_only_modules|merge(data) %}
        {% endif %}

        {# Check if standard module is already in list #}
        {% set found = false %}
        {% for m in all_modules %}
            {% set name = m.getName()|replace({'CAWeb_Module_' : '', 'CAWeb_Module_Fullwidth_' : ''}) %}
            {% set current_name = module.getName()|replace({'CAWeb_Module_' : '', 'CAWeb_Module_Fullwidth_' : ''}) %}

            {% if not found and name == current_name %}
                {% set found = true %}
            {% endif %}
        {% endfor %}

        {% if not found %}
            {% set all_modules = all_modules|merge(data) %}
        {% endif %}
    {% endif %}
{% endfor %}

{% block head %}
<title>{{ project.name }}</title>
{% endblock head %}

{% block introduction %}
<div class="offset-quarter">
    <p>Child Modules: {{ child_modules|length }}</p>
    <p>Fullwidth Modules: {{ fullwidth_only_modules|length }}</p>
    <p>Total Modules: {{ all_modules|length }}</p>
</div>
{% endblock introduction %}

{% block table_of_contents %}
<div class="offset-quarter clearfix">
    <div class="pl-0 half">
        <h2 class="my-0">Modules</h2>

        <ul class="list-overstated">
            {# iterate thru all modules #}
            {% for module in all_modules %}
            {% set display_name = module.getName()|replace({'CAWeb_Module_' : '', 'CAWeb_Module_Fullwidth_' : ''}) %}
            {% set type = module.getProperties().post_types is not empty ? module.getProperties().post_types.getDefault()|replace({'array' : '', "'" : '', '(' : '', ')' : ''})|split(',') : '' %}
            <li>
                <a href="#{{ display_name|lower }}">{{ display_name|replace({'_':' '}) }}</a> 

                {# Add standard module icon, if no type is set or if available on post and pages #}
                {% if type is empty or 'post' in type or 'page' in type %}
                    {{ macros.letter_icon('S', '', 'danger') }}
                {% endif %}
                
                {# Check if there is also a fullwidth #}
                {% set has_fullwidth = false %}

                {% for full_module in fullwidth_only_modules %}
                {% set full_module_display_name = full_module.getName()|replace({'CAWeb_Module_Fullwidth_' : ''}) %}
                    {% if not has_fullwidth and display_name == full_module_display_name %}
                        {# Add fullwidth module icon, if fullwidth version exists #}
                        {% set has_fullwidth = true %}
                        {{ macros.letter_icon('F', '', 'success') }}
                    {% endif %}
                {% endfor %}

                
                {# Add post specific icon, if available on posts only #}
                {% if type is not empty and 'post' in type %}
                    {{ macros.letter_icon('P', '', 'dark') }}
                {% endif %}

            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="half">
        <h2 class="my-0">Legend</h2>
        <small>
            <p>{{ macros.letter_icon('S', '', 'danger') }} - Standard Module</p>
            <p>{{ macros.letter_icon('F', '', 'success') }} - Fullwidth Module</p>
            <p>{{ macros.letter_icon('P', '', 'dark') }} - Post Only Module</p>
        </small>
    </div>
</div>
{% endblock table_of_contents %}

{% block body %}
<div class="offset-quarter clearfix">
    
    {# iterate thru all modules #}
    {% for module in all_modules %}
    {% set display_name = module.getName()|replace({'CAWeb_Module_' : '', 'CAWeb_Module_Fullwidth_' : ''}) %}
    <div class="row">
        <div class="container">
            <h3 id="{{ display_name|lower }}" class="my-0">{{ display_name|replace({'_':' '}) }}</h3>
            <p>{{ module.getFile().getDescription() }}</p>
            <div class="offset-quarter half">
                {% if 'Card' == display_name %}
                    {% block card %}
                        {% set card_header_text = 'Card Header Text' %}
                        {% set card_footer_text = 'Card Footer Text' %}
                        {% set card_image_src = path('/') ~ 'imgs/samples/bobcat.jpg' %}
                        {% set card_image_alt_text = 'Bobcat' %}
                     
                        {% set card_content %}
                        <p>Card Content Here</p>
                        {% endset %}
             
                        {{ parent() }}
                         
                    {% endblock card %}
                {% elseif 'GitHub' == display_name %}
                    {% block github %}
                    {{ parent() }}
                    {% endblock github %}
                {% elseif 'Panel' == display_name %}
                    {% block panel %}
                    {% set panel_header_text = 'Panel Header Text' %}
                    {% set panel_header_logo = 'info' %}
                    {% set panel_read_more_url = '#panel' %}
                    {% set panel_read_more_text = 'Learn More' %}

                    {% set panel_content %}
                    <p>Panel Content Here</p>
                    {% endset %}
         
                    {{ parent() }}
                    {% endblock panel %}
                {% elseif 'Profile_Banner' == display_name %}
                    {% block profile_banner %}
                    {% set profile_banner_layout = 'round' %}
                    {% set profile_banner_name = 'Profile Name' %}
                    {% set profile_banner_job_title = 'Job Title' %}
                    {% set profile_banner_url = '#profile_banner' %}
                    {% set profile_banner_url_text = 'Profile Link' %}
                    {% set profile_banner_image_src = path('/') ~ 'imgs/samples/guy.jpg' %}
                    {% set profile_banner_image_alt = 'Male Portrait' %}

                    {{ parent() }}
                    {% endblock profile_banner %}
                {% endif %}
            </div>
        </div>        
    </div>
    {% endfor %}
</div>
{% endblock body %}